      SUBROUTINE HOURB8(BMATX,CARTD,DVOLU,ELCOD,
     .                  NDIME,NEVAB,NNODE,NSTRS)
C***********************************************************************
C
C****THIS ROUTINE COMPURES THE "HOURGLASS" B-MATRICES FOR THE 
C       8-NODE ELEMENT
C
C***********************************************************************
      IMPLICIT REAL*8(A-H,O-Z)
      DIMENSION BMATX(NSTRS,NEVAB,6), CARTD(NDIME,*), ELCOD(NDIME,*)  
      DIMENSION ETZ(8,3), H(8,4), GAMMA(8,4), A(3,3), DERIV(8,18),
     .          P(8,3), Q(8,3), R(8,3), B(8,3)
      DATA ETZ/-1.0, 1.0, 1.0,-1.0,-1.0, 1.0, 1.0,-1.0,
     .         -1.0,-1.0, 1.0, 1.0,-1.0,-1.0, 1.0, 1.0,
     .         -1.0,-1.0,-1.0,-1.0, 1.0, 1.0, 1.0, 1.0/
      DATA   H/ 1.0,-1.0, 1.0,-1.0, 1.0,-1.0, 1.0,-1.0,
     .          1.0,-1.0,-1.0, 1.0,-1.0, 1.0, 1.0,-1.0,
     .          1.0, 1.0,-1.0,-1.0,-1.0,-1.0, 1.0, 1.0,
     .         -1.0, 1.0,-1.0, 1.0, 1.0,-1.0, 1.0,-1.0/
C
C     DEFINE JACOBIAN MATRIX
C
      COE64=1.0/(64.0*DVOLU)
      DO IDIME=1,NDIME*NDIME
        A(IDIME,1)=0.0
      ENDDO
      DO IDIME=1,NDIME
        DO JDIME=1,NDIME
          DO KNODE=1,NNODE
            A(IDIME,JDIME)=A(IDIME,JDIME)+
     .                         ETZ(KNODE,IDIME)*ELCOD(JDIME,KNODE)
          ENDDO
        ENDDO
      ENDDO
C
C     DEFINE C COEFFICIENTS
C
      C123=A(2,2)*A(3,3)-A(3,2)*A(2,3)
      C113=A(3,2)*A(1,3)-A(1,2)*A(3,3)
      C112=A(1,2)*A(2,3)-A(2,2)*A(1,3)
      C223=A(3,1)*A(2,3)-A(2,1)*A(3,3)
      C213=A(1,1)*A(3,3)-A(3,1)*A(1,3)
      C212=A(2,1)*A(1,3)-A(1,1)*A(2,3)
      C323=A(2,1)*A(3,2)-A(3,1)*A(2,2)
      C313=A(3,1)*A(1,2)-A(1,1)*A(3,2)
      C312=A(1,1)*A(2,2)-A(2,1)*A(1,2)
C
C     DEFINE B
C
c     DO INODE=1,NNODE
c       B(INODE,1)=COE64*(C123*ETZ(INODE,1)+C113*ETZ(INODE,2)+
c    .                                      C112*ETZ(INODE,3))
c       B(INODE,2)=COE64*(C223*ETZ(INODE,1)+C213*ETZ(INODE,2)+
c    .                                      C212*ETZ(INODE,3))
c       B(INODE,3)=COE64*(C323*ETZ(INODE,1)+C313*ETZ(INODE,2)+
c    .                                      C312*ETZ(INODE,3))
c     ENDDO
C
C     DEFINE GAMMA
C
      DO INDEX=1,4
        PRODX=0.0
        PRODY=0.0
        PRODZ=0.0
        DO JNODE=1,NNODE
          PRODX=PRODX+H(JNODE,INDEX)*ELCOD(1,JNODE)
          PRODY=PRODY+H(JNODE,INDEX)*ELCOD(2,JNODE)
          PRODZ=PRODZ+H(JNODE,INDEX)*ELCOD(3,JNODE)
        ENDDO
        DO INODE=1,NNODE
          GAMMA(INODE,INDEX)=H(INODE,INDEX)-PRODX*CARTD(1,INODE)
     .                         -PRODY*CARTD(2,INODE)-PRODZ*
     .                         CARTD(3,INODE)
        ENDDO
      ENDDO
C
C     DEFINE P, Q, R ARRAYS
C
      DO INODE=1,NNODE
        P(INODE,1)=C123*H(INODE,1)+C112*H(INODE,3)
        P(INODE,2)=C223*H(INODE,1)+C212*H(INODE,3)
        P(INODE,3)=C323*H(INODE,1)+C312*H(INODE,3)
        Q(INODE,1)=C123*H(INODE,2)+C113*H(INODE,3)
        Q(INODE,2)=C223*H(INODE,2)+C213*H(INODE,3)
        Q(INODE,3)=C323*H(INODE,2)+C313*H(INODE,3)
        R(INODE,1)=C113*H(INODE,1)+C112*H(INODE,2)
        R(INODE,2)=C213*H(INODE,1)+C212*H(INODE,2)
        R(INODE,3)=C313*H(INODE,1)+C312*H(INODE,2)
      ENDDO
C
C     DEFINE INNER PRODUCTS
C
      P1X=0.0
      P1Y=0.0
      P1Z=0.0
      P2X=0.0
      P2Y=0.0
      P2Z=0.0
      P3X=0.0
      P3Y=0.0
      P3Z=0.0
      Q1X=0.0
      Q1Y=0.0
      Q1Z=0.0
      Q2X=0.0
      Q2Y=0.0
      Q2Z=0.0
      Q3X=0.0
      Q3Y=0.0
      Q3Z=0.0
      R1X=0.0
      R1Y=0.0
      R1Z=0.0
      R2X=0.0
      R2Y=0.0
      R2Z=0.0
      R3X=0.0
      R3Y=0.0
      R3Z=0.0
      DO JNODE=1,NNODE
        P1X=P1X+P(JNODE,1)*ELCOD(1,JNODE)
        P1Y=P1Y+P(JNODE,1)*ELCOD(2,JNODE)
        P1Z=P1Z+P(JNODE,1)*ELCOD(3,JNODE)
        P2X=P2X+P(JNODE,2)*ELCOD(1,JNODE)
        P2Y=P2Y+P(JNODE,2)*ELCOD(2,JNODE)
        P2Z=P2Z+P(JNODE,2)*ELCOD(3,JNODE)
        P3X=P3X+P(JNODE,3)*ELCOD(1,JNODE)
        P3Y=P3Y+P(JNODE,3)*ELCOD(2,JNODE)
        P3Z=P3Z+P(JNODE,3)*ELCOD(3,JNODE)
        Q1X=Q1X+Q(JNODE,1)*ELCOD(1,JNODE)
        Q1Y=Q1Y+Q(JNODE,1)*ELCOD(2,JNODE)
        Q1Z=Q1Z+Q(JNODE,1)*ELCOD(3,JNODE)
        Q2X=Q2X+Q(JNODE,2)*ELCOD(1,JNODE)
        Q2Y=Q2Y+Q(JNODE,2)*ELCOD(2,JNODE)
        Q2Z=Q2Z+Q(JNODE,2)*ELCOD(3,JNODE)
        Q3X=Q3X+Q(JNODE,3)*ELCOD(1,JNODE)
        Q3Y=Q3Y+Q(JNODE,3)*ELCOD(2,JNODE)
        Q3Z=Q3Z+Q(JNODE,3)*ELCOD(3,JNODE)
        R1X=R1X+R(JNODE,1)*ELCOD(1,JNODE)
        R1Y=R1Y+R(JNODE,1)*ELCOD(2,JNODE)
        R1Z=R1Z+R(JNODE,1)*ELCOD(3,JNODE)
        R2X=R2X+R(JNODE,2)*ELCOD(1,JNODE)
        R2Y=R2Y+R(JNODE,2)*ELCOD(2,JNODE)
        R2Z=R2Z+R(JNODE,2)*ELCOD(3,JNODE)
        R3X=R3X+R(JNODE,3)*ELCOD(1,JNODE)
        R3Y=R3Y+R(JNODE,3)*ELCOD(2,JNODE)
        R3Z=R3Z+R(JNODE,3)*ELCOD(3,JNODE)
      ENDDO
C
C     DEFINE DERIVATIVE ARRAYS
C
      DO INODE=1,NNODE
        DERIV(INODE, 1)=C113*GAMMA(INODE,1)+C112*GAMMA(INODE,2)
        DERIV(INODE, 2)=C213*GAMMA(INODE,1)+C212*GAMMA(INODE,2)
        DERIV(INODE, 3)=C313*GAMMA(INODE,1)+C312*GAMMA(INODE,2)
        DERIV(INODE, 4)=C123*GAMMA(INODE,1)+C112*GAMMA(INODE,3)
        DERIV(INODE, 5)=C223*GAMMA(INODE,1)+C212*GAMMA(INODE,3)
        DERIV(INODE, 6)=C323*GAMMA(INODE,1)+C312*GAMMA(INODE,3)
        DERIV(INODE, 7)=C123*GAMMA(INODE,2)+C113*GAMMA(INODE,3)
        DERIV(INODE, 8)=C223*GAMMA(INODE,2)+C213*GAMMA(INODE,3)
        DERIV(INODE, 9)=C323*GAMMA(INODE,2)+C313*GAMMA(INODE,3)
      ENDDO
      DO INDEX=1,NNODE*9
        DERIV(INDEX,1)=COE64*DERIV(INDEX,1)
      ENDDO
      DO INODE=1,NNODE
        DERIV(INODE,10)=C112*GAMMA(INODE,4)
     .     -P1X*DERIV(INODE,1)-P1Y*DERIV(INODE,2)-P1Z*DERIV(INODE,3)
     .     -R1X*DERIV(INODE,4)-R1Y*DERIV(INODE,5)-R1Z*DERIV(INODE,6)
        DERIV(INODE,11)=C212*GAMMA(INODE,4)
     .     -P2X*DERIV(INODE,1)-P2Y*DERIV(INODE,2)-P2Z*DERIV(INODE,3)
     .     -R2X*DERIV(INODE,4)-R2Y*DERIV(INODE,5)-R2Z*DERIV(INODE,6)
        DERIV(INODE,12)=C312*GAMMA(INODE,4)
     .     -P3X*DERIV(INODE,1)-P3Y*DERIV(INODE,2)-P3Z*DERIV(INODE,3)
     .     -R3X*DERIV(INODE,4)-R3Y*DERIV(INODE,5)-R3Z*DERIV(INODE,6)
        DERIV(INODE,13)=C123*GAMMA(INODE,4)
     .     -Q1X*DERIV(INODE,4)-Q1Y*DERIV(INODE,5)-Q1Z*DERIV(INODE,6)
     .     -P1X*DERIV(INODE,7)-P1Y*DERIV(INODE,8)-P1Z*DERIV(INODE,9)
        DERIV(INODE,14)=C223*GAMMA(INODE,4)
     .     -Q2X*DERIV(INODE,4)-Q2Y*DERIV(INODE,5)-Q2Z*DERIV(INODE,6)
     .     -P2X*DERIV(INODE,7)-P2Y*DERIV(INODE,8)-P2Z*DERIV(INODE,9)
        DERIV(INODE,15)=C323*GAMMA(INODE,4)
     .     -Q3X*DERIV(INODE,4)-Q3Y*DERIV(INODE,5)-Q3Z*DERIV(INODE,6)
     .     -P3X*DERIV(INODE,7)-P3Y*DERIV(INODE,8)-P3Z*DERIV(INODE,9)
        DERIV(INODE,16)=C113*GAMMA(INODE,4)
     .     -Q1X*DERIV(INODE,1)-Q1Y*DERIV(INODE,2)-Q1Z*DERIV(INODE,3)
     .     -R1X*DERIV(INODE,7)-R1Y*DERIV(INODE,8)-R1Z*DERIV(INODE,9)
        DERIV(INODE,17)=C213*GAMMA(INODE,4)
     .     -Q2X*DERIV(INODE,1)-Q2Y*DERIV(INODE,2)-Q2Z*DERIV(INODE,3)
     .     -R2X*DERIV(INODE,7)-R2Y*DERIV(INODE,8)-R2Z*DERIV(INODE,9)
        DERIV(INODE,18)=C313*GAMMA(INODE,4)
     .     -Q3X*DERIV(INODE,1)-Q3Y*DERIV(INODE,2)-Q3Z*DERIV(INODE,3)
     .     -R3X*DERIV(INODE,7)-R3Y*DERIV(INODE,8)-R3Z*DERIV(INODE,9)
      ENDDO
      DO INDEX=NNODE*9+1,NNODE*18
        DERIV(INDEX,1)=COE64*DERIV(INDEX,1)
      ENDDO
C
C     DEFINE B MATRIX
C
      COE13=1.0/3.0
      COE23=2.0/3.0
      IDEVF=0
      IF(IDEVF.EQ.1) THEN
        COE13=0.0
        COE23=1.0
      ENDIF
      DO INDEX=1,6
        K1=(INDEX-1)*3+1
        K2=K1+1
        K3=K2+1
        DO INODE=1,NNODE
          J1=(INODE-1)*3+1
          J2=J1+1
          J3=J2+1
          BMATX(1,J1,INDEX)= COE23*DERIV(INODE,K1)
          BMATX(1,J2,INDEX)=-COE13*DERIV(INODE,K2)
          BMATX(1,J3,INDEX)=-COE13*DERIV(INODE,K3)
          BMATX(2,J1,INDEX)=-COE13*DERIV(INODE,K1)
          BMATX(2,J2,INDEX)= COE23*DERIV(INODE,K2)
          BMATX(2,J3,INDEX)=-COE13*DERIV(INODE,K3)
          BMATX(4,J1,INDEX)=-COE13*DERIV(INODE,K1)
          BMATX(4,J2,INDEX)=-COE13*DERIV(INODE,K2)
          BMATX(4,J3,INDEX)= COE23*DERIV(INODE,K3)
          BMATX(3,J1,INDEX)=       DERIV(INODE,K2)
          BMATX(3,J2,INDEX)=       DERIV(INODE,K1)
          BMATX(3,J3,INDEX)=       0.0
          BMATX(6,J1,INDEX)=       0.0
          BMATX(6,J2,INDEX)=       DERIV(INODE,K3)
          BMATX(6,J3,INDEX)=       DERIV(INODE,K2)
          BMATX(5,J1,INDEX)=       DERIV(INODE,K3)
          BMATX(5,J2,INDEX)=       0.0
          BMATX(5,J3,INDEX)=       DERIV(INODE,K1)
        ENDDO
      ENDDO
C
      RETURN
      END
