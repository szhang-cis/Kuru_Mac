      SUBROUTINE OUTPOSS(ELDATS,LNODSS,MATNOS,PROELS,PROPSS,COORDS,
     .                   GPCODS,
     .                   ELPRES,ELVARS,ELMATS,DISPLS,WORK1S)
C***********************************************************************
C
C**** THIS ROUTINE DUMPS THE GEOMETRIC MODEL FOR POSTPROCESS
C
C     Note: Gauss coordinates should not be printed in post file
C
C***********************************************************************
      IMPLICIT REAL*8(A-H,O-Z)
C
C**** ADDITIONAL PARAMETERS
C
      INCLUDE 'addi_oms.f'
C
C**** COUPLING VARIABLES
C
      INCLUDE 'nuec_om.f'          ! thermal-mechanical
      INCLUDE 'nued_om.f'          ! thermal-microstructural
C
C**** MICROSTRUCTURAL VARIABLES
C
      INCLUDE 'prob_oms.f'
      INCLUDE 'auxl_oms.f'
C
      DIMENSION MATNOS(NELEMS),        LNODSS(NNODES,NELEMS),
     .          PROELS(NPRELS,NGRUPS), PROPSS(NPROPS,NMATSS),
     .          ELDATS(NDATAS),        COORDS(NDIMES,*),
     .          GPCODS(NDIMES,*)
      DIMENSION WORK1S(*)
      DIMENSION ELPRES(NPREVS),
     .          ELVARS(NSTATS),        ELMATS(NMATXS),
     .          DISPLS(NTOTVMS)
C
C**** WRITE CONTROL DATA FOR POSTPROCESSOR
C
      OPEN(UNIT=LUPOSS,FILE=CJS,STATUS='OLD',FORM='UNFORMATTED',
     .     ACCESS='APPEND')
C
      WRITE(LUPOSS) NDIMES,NDOFCS,NDOFNS,NGAUSS,NHISTS,NNODES,NELEMS,
     .              NGRUPS,
     .              NMATSS,NPOINS,NPRELS,NPROPS,NSTR1S,TITLES,NDATAS,
     .              NSTATS,
     .              KSGAUS,NNUINS,NNUPCS,NPOROS,LARGES,KDYNAS
C
      ICOUNS=0
      DO 101 IELEMS=1,NELEMS
      LGRUPS=MATNOS(IELEMS)
      LMATSS=INT(PROELS(1,LGRUPS))
      LTYPES=INT(PROELS(5,LGRUPS))
      NNODLS=INT(PROELS(2,LGRUPS))
      IF(LTYPES.EQ.101.OR.LTYPES.EQ.104) GO TO 101  !SKIP CONTACT ELEM.
C
C**** READ NODAL AND GAUSSIAN COORDINATES FROM DATA-BASE
C
      IF(NMEMO1S.EQ.0.OR.NMEMO2S.EQ.0)
     . CALL DATBASS(ELDATS,    1,    2)
C
      IF(NMEMO2S.NE.0.AND.KPPCGS.NE.0) THEN
C
C**** GATHER NODAL COORDINATES
C
       IF(NMEMO1S.EQ.1) THEN    ! coordinates in a global array
        CALL GATHER(COORDS,NDIMES,NPOINS,WORK1S(ISTARS(11)),NDIMES,
     .              NNODLS,LNODSS(1,IELEMS))
       ENDIF
C
       IF(ITERME.GT.0) THEN          ! bidirectional coupled
        IF(ITERMD.EQ.1) THEN         ! deformed shape
C
C**** SCALAR GATHER OPERATIONS ( DISPLT ---> WORK1T(ISTART(17)) )
C
         CALL GATHER(DISPLS,NDOFCMS,NPOINS,WORK1S(ISTARS(17)),NDOFCMS,
     .               NNODLS,
     .               LNODSS(1,IELEMS))
        ENDIF                        ! itermd.eq.1
       ENDIF                         ! iterme.gt.0
C
C**** CALL ELEMENT PROCESSOR TO PERFORM REQUIRED OPERATIONS
C
       CALL ELMLIBS(LNODSS(1,IELEMS),PROELS(1,LGRUPS),PROPSS(1,LMATSS),
     .              ELDATS,ELPRES,ELVARS,ELMATS,WORK1S,      16)
C
C**** WORK1T(ISTART(5) --> GPCODS
C
       IKOUNS=0
       DO IDIMES=1,NDIMES
        DO IGAUSS=1,NGAULS
         GPCODS(IDIMES,IGAUSS)=WORK1S(ISTARS(5)+IKOUNS)
         IKOUNS=IKOUNS+1
        ENDDO
       ENDDO
      ENDIF               ! nmemo2s.ne.0.and.kppcgs.ne.0
C
C**** RECOVER NODAL COORDINATES AND PUT THEM IN GLOBAL VECTOR
C
      IF(NMEMO1S.EQ.0) THEN     ! coordinates in an elemental array
       KCOUNS=0
       DO 100 INODES=1,NNODES
       LNODES=LNODSS(INODES,IELEMS)
       IF(LNODES.EQ.0) GO TO 100
C$DIR SCALAR
       DO IDIMES=1,NDIMES
        COORDS(IDIMES,LNODES)=ELDATS(IDATAS(1)+KCOUNS)
        KCOUNS=KCOUNS+1
       ENDDO
  100 CONTINUE
      ENDIF
C
C**** RECOVER GAUSSIAN COORDINATES AND WRITES THEM TO POSTPROCESS FILE
C
      IF(NMEMO2S.EQ.0) THEN
       ICOUNS=0
       DO IGAUSS=1,NGAUSS
C$DIR SCALAR
        DO IDIMES=1,NDIMES
         GPCODS(IDIMES,IGAUSS)=ELDATS(IDATAS(4)+ICOUNS)
         ICOUNS=ICOUNS+1
        ENDDO
       ENDDO
      ENDIF
C
      IF(KPPCGS.NE.0) THEN
       WRITE(LUPOSS) ((SNGL(GPCODS(IDIMES,IGAUSS)),
     .                 IDIMES=1,NDIMES),IGAUSS=1,NGAUSS)
      ENDIF
C
  101 CONTINUE
C
C**** WRITE GEOMETRY FOR POSTPROCESSOR
C
      WRITE(LUPOSS)
     .((SNGL(COORDS(IDIMES,IPOINS)),IDIMES=1,NDIMES),IPOINS=1,NPOINS),
     .  LNODSS,MATNOS,
     .((SNGL(PROELS(IPRELS,IGRUPS)),IPRELS=1,NPRELS),IGRUPS=1,NGRUPS),
     .((SNGL(PROPSS(IPROPS,IMATSS)),IPROPS=1,NPROPS),IMATSS=1,NMATSS),
     .  IDATAS,ISTATS
C
      CLOSE(LUPOSS)
C
      END
